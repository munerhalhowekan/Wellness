<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Diet Plan ‚Äî Wellness</title>
<style>
  :root{
    --bg:#1c1c1c; --layer:#222; --card:#2a2a2a; --text:#fff; --muted:#cfcfcf;
    --border:#3a3a3a; --accent:#ff6600; --accent-2:#ff8533; --ok:#0fb76b;
    --shadow:0 0 18px rgba(255,102,0,.28);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:"Poppins","Segoe UI",system-ui,Arial,sans-serif}

  /* Header (same as other pages) */
  header{
    position:sticky;top:0;z-index:60;background:var(--layer);border-bottom:1px solid var(--border);
    display:flex;align-items:center;justify-content:space-between;padding:12px 18px;box-shadow:0 4px 12px rgba(0,0,0,.25);
  }
  .hamburger{cursor:pointer;font-size:24px;user-select:none}
  .page{font-weight:800}
  .logo-link{display:flex;align-items:center}
  .logo-img{width:120px;height:auto;object-fit:contain}

  /* Drawer */
  .drawer{
    position:fixed;left:-260px;top:0;height:100vh;width:260px;background:var(--card);
    border-right:1px solid var(--border);box-shadow:16px 0 30px rgba(0,0,0,.45);
    padding:18px;z-index:80;transition:left .28s ease;
  }
  .drawer.open{left:0}
  .drawer h4{margin:4px 8px 12px;color:var(--accent)}
  .drawer a{display:block;color:var(--text);text-decoration:none;padding:10px;border-radius:10px;margin:6px 0}
  .drawer a:hover{background:rgba(255,102,0,.15)}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;z-index:70}
  .overlay.show{display:block}

  main{padding:18px 22px;max-width:1200px;margin:0 auto}

  /* Day bar */
  .daybar{
    display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:16px;
    background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 14px;box-shadow:var(--shadow);
  }
  .daybtn{
    background:#333;border:1px solid var(--border);color:#fff;border-radius:10px;padding:8px 12px;cursor:pointer;font-weight:800;
  }
  .daybtn:disabled{opacity:.4;cursor:not-allowed}
  .daytitle{font-weight:900;letter-spacing:.3px}

  /* Meal row */
  .meal-row{
    display:grid;grid-template-columns:repeat(3, 1fr);gap:14px;
  }
  .meal{
    background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:var(--shadow);
  }
  .meal h3{margin:0 0 8px;color:var(--accent)}
  .kcal{color:var(--muted);margin:0 0 10px}
  .items{margin:0 0 12px;padding-left:18px}
  .items li{margin:4px 0}
  .check{
    background:var(--accent);color:#fff;border:none;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer;
  }
  .check.done{background:var(--ok)}
  .meal.locked{opacity:.7}
  .locked-note{
    margin-top:12px;color:var(--muted);font-size:.9rem
  }

  /* Responsive */
  @media (max-width: 900px){
    .meal-row{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<!-- Drawer + overlay -->
<aside id="drawer" class="drawer" aria-hidden="true">
  <h4>Navigation</h4>
  <a href="user-dashboard.html">üè† Dashboard</a>
  <a href="exercises.html">üí™ Exercises</a>
  <a href="dietplan.html">ü•ó Diet Plan</a>
  <a href="leaderboard.html">üèÜ Leaderboard</a>
</aside>
<div id="overlay" class="overlay" onclick="toggleDrawer(false)"></div>

<!-- Header -->
<header>
  <div class="hamburger" onclick="toggleDrawer()">‚ò∞</div>
  <div class="page">Diet Plan</div>
  <a href="user-dashboard.html" class="logo-link">
    <img src="wellness logo.png" alt="Wellness Logo" class="logo-img">
  </a>
</header>

<main>
  <!-- Day navigation -->
  <div class="daybar">
    <button id="prevDay" class="daybtn" onclick="goPrev()"><span>&larr;</span></button>
    <div class="daytitle" id="dayTitle">Sunday</div>
    <button id="nextDay" class="daybtn" onclick="goNext()"><span>&rarr;</span></button>
  </div>

  <!-- Meals -->
  <div class="meal-row" id="mealRow"></div>
  <div class="locked-note" id="lockedNote" style="display:none">Past day ‚Äî changes are locked.</div>
</main>

<script>
/* ===== Drawer ===== */
function toggleDrawer(force){
  const d=document.getElementById('drawer'), o=document.getElementById('overlay');
  const open=(typeof force==='boolean')?force:!d.classList.contains('open');
  d.classList.toggle('open',open); o.classList.toggle('show',open);
}
document.querySelectorAll('#drawer a').forEach(a=>a.addEventListener('click',()=>toggleDrawer(false)));

/* ===== Diet Data (prefilled) ===== */
const DAYS=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
// simple sample plan ‚Äî you can tweak values anytime
const PREFILL={
  Sunday:   [{meal:'Breakfast',kcal:250,items:['1 Egg','Coffee (2)']},
             {meal:'Lunch',kcal:600,items:['Grilled Chicken','Rice']},
             {meal:'Dinner',kcal:400,items:['Salad','Soup']}],
  Monday:   [{meal:'Breakfast',kcal:300,items:['Oatmeal','Banana']},
             {meal:'Lunch',kcal:650,items:['Beef Wrap','Yogurt']},
             {meal:'Dinner',kcal:420,items:['Tuna Salad','Apple']}],
  Tuesday:  [{meal:'Breakfast',kcal:280,items:['Scrambled Eggs','Toast']},
             {meal:'Lunch',kcal:620,items:['Turkey Sandwich','Orange']},
             {meal:'Dinner',kcal:430,items:['Stir Fry Veggies','Rice']}],
  Wednesday:[{meal:'Breakfast',kcal:260,items:['Greek Yogurt','Honey']},
             {meal:'Lunch',kcal:640,items:['Pasta','Chicken Breast']},
             {meal:'Dinner',kcal:410,items:['Lentil Soup','Salad']}],
  Thursday: [{meal:'Breakfast',kcal:270,items:['Smoothie','Almonds']},
             {meal:'Lunch',kcal:630,items:['Baked Fish','Potatoes']},
             {meal:'Dinner',kcal:420,items:['Quinoa','Veggies']}],
  Friday:   [{meal:'Breakfast',kcal:290,items:['Peanut Butter Toast','Milk']},
             {meal:'Lunch',kcal:610,items:['Burger (lean)','Side Salad']},
             {meal:'Dinner',kcal:400,items:['Chicken Soup','Bread']}],
  Saturday: [{meal:'Breakfast',kcal:310,items:['Pancakes','Berries']},
             {meal:'Lunch',kcal:700,items:['Pizza (2 slices)','Salad']},
             {meal:'Dinner',kcal:380,items:['Grilled Veggies','Hummus']}]
};

/* ===== Persistence ===== */
const STORE_KEY='wellness.diet'; // { weekStartISO, days: { Sunday:{breakfast:true,...}, ... } }
function loadState(){
  try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || null; }catch{ return null; }
}
function saveState(state){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }

/* Start of current week (Sunday 00:00) used to know when to lock past days */
function weekStart(date=new Date()){
  const d=new Date(date); // copy
  const day=d.getDay(); // 0=Sunday
  d.setHours(0,0,0,0);
  d.setDate(d.getDate()-day); // go back to Sunday
  return d;
}

/* Initialize state for a new week */
function ensureState(){
  const now=new Date();
  const start=weekStart(now).toISOString();
  let s=loadState();
  if(!s || s.weekStartISO!==start){
    s={weekStartISO:start, days:{}};
    DAYS.forEach(name=>{
      const base=PREFILL[name];
      s.days[name]={ // booleans for done flags
        Breakfast:false, Lunch:false, Dinner:false,
        // store kcal & items to keep storyline consistent
        plan: base
      };
    });
    saveState(s);
  }
  return s;
}

/* ===== Page State ===== */
let app={ state: ensureState(), currentIndex: 0 }; // 0 = Sunday

/* Restore last viewed day if we saved it */
const lastIdx = +localStorage.getItem('wellness.diet.index') || 0;
app.currentIndex = Math.min(Math.max(0,lastIdx), 6);

/* Lock logic: a day is locked if it is before today's index (same week) */
function todayIndex(){ return new Date().getDay(); } // Sunday=0

/* Render UI */
function render(){
  const dayName = DAYS[app.currentIndex];
  document.getElementById('dayTitle').textContent = dayName;

  // arrows
  document.getElementById('prevDay').disabled = app.currentIndex === 0;
  document.getElementById('nextDay').disabled = app.currentIndex === 6;

  // lock status
  const isLocked = app.currentIndex < todayIndex();
  const note = document.getElementById('lockedNote');
  note.style.display = isLocked ? 'block' : 'none';

  // meals
  const container = document.getElementById('mealRow');
  container.innerHTML = '';
  const dstate = app.state.days[dayName];

  PREFILL[dayName].forEach(plan=>{
    const mealName = plan.meal;
    const done = !!dstate[mealName];

    const card = document.createElement('div');
    card.className = 'meal' + (isLocked ? ' locked' : '');
    card.innerHTML = `
      <h3>${mealName}</h3>
      <p class="kcal">${plan.kcal} kcal</p>
      <ul class="items">${plan.items.map(x=>`<li>${x}</li>`).join('')}</ul>
      <button class="check ${done?'done':''}" ${isLocked?'disabled':''}>
        ${done ? 'Done ‚úì' : '‚úì'}
      </button>
    `;

    const btn = card.querySelector('.check');
    if(!isLocked){
      btn.addEventListener('click', ()=>{
        const newVal = !dstate[mealName];
        dstate[mealName] = newVal;
        saveState(app.state);
        render();
      });
    }
    container.appendChild(card);
  });

  // remember position
  localStorage.setItem('wellness.diet.index', String(app.currentIndex));
}

/* Navigation */
function goPrev(){ if(app.currentIndex>0){ app.currentIndex--; render(); } }
function goNext(){ if(app.currentIndex<6){ app.currentIndex++; render(); } }

/* Auto-advance at midnight to next day and lock previous day */
function scheduleMidnightTick(){
  const now = new Date();
  const nextMidnight = new Date(now);
  nextMidnight.setHours(24,0,0,0); // upcoming 00:00
  const ms = nextMidnight - now;
  setTimeout(()=>{
    // move to next day if possible
    const tIdx = todayIndex(); // after midnight this becomes next day
    if(app.currentIndex < tIdx) { app.currentIndex = tIdx; }
    render();
    scheduleMidnightTick(); // schedule again
  }, ms + 50); // small buffer
}

/* Init */
render();
scheduleMidnightTick();
</script>
</body>
</html>
